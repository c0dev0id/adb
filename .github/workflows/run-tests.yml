name: Run Tests

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]
  workflow_dispatch:

jobs:
  openbsd:
    name: OpenBSD Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build and Test on OpenBSD
        uses: cross-platform-actions/action@v0.32.0
        with:
          operating_system: openbsd
          version: '7.8'
          run: |
            doas pkg_add -v pkgconf libusb libressl
            cd adb
            make clean || true
            make -j2
            if [ -x ./adb ]; then
              echo "adb binary built successfully. Running smoke test:"
              ./adb --version || ./adb -V || ./adb --help || true
            else
              echo "adb was not built (no ./adb)."
              exit 1
            fi
